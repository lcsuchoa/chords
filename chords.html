<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.361">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>chords</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="chords_files/libs/clipboard/clipboard.min.js"></script>
<script src="chords_files/libs/quarto-html/quarto.js"></script>
<script src="chords_files/libs/quarto-html/popper.min.js"></script>
<script src="chords_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="chords_files/libs/quarto-html/anchor.min.js"></script>
<link href="chords_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="chords_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="chords_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="chords_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="chords_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">chords</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>top_genres <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"rock"</span>, <span class="st">"gospelreligioso"</span>, <span class="st">"sertanejo"</span>, <span class="st">"mpb"</span>, <span class="st">"alternativo"</span>,</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>             <span class="st">"axe"</span>, <span class="st">"funk"</span>, <span class="st">"pop"</span>, <span class="st">"forro"</span>, <span class="st">"samba"</span>,</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>             <span class="st">"bossa-nova"</span>, <span class="st">"blues"</span>, <span class="st">"jazz"</span>, <span class="st">"k-pop"</span>, <span class="st">"pagode"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># arquivo final para análise</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(top_songs, <span class="st">"top_musicas_20230916.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<section id="validação-da-qualidade-do-scraping" class="level1">
<h1>Validação da qualidade do scraping</h1>
<section id="quantidade-de-músicas-por-gênero" class="level4">
<h4 class="anchored" data-anchor-id="quantidade-de-músicas-por-gênero">Quantidade de músicas por gênero</h4>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 15 × 2
# Groups:   genre [15]
   genre          n
   &lt;chr&gt;      &lt;int&gt;
 1 jazz          91
 2 blues         92
 3 altern        98
 4 kpop          98
 5 bossa-nova    99
 6 funk          99
 7 axe          100
 8 forro        100
 9 gospel       100
10 mpb          100
11 pagode       100
12 pop          100
13 rock         100
14 samba        100
15 sertanejo    100</code></pre>
</div>
</div>
</section>
<section id="quantidade-de-músicas-repetidas" class="level4">
<h4 class="anchored" data-anchor-id="quantidade-de-músicas-repetidas">Quantidade de músicas repetidas</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>top_songs <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">duplicated</span>(top_songs<span class="sc">$</span>url)) <span class="sc">%&gt;%</span> <span class="fu">nrow</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
</div>
<p><br></p>
</section>
</section>
<section id="análise-exploratória-inicial" class="level1">
<h1>Análise exploratória inicial</h1>
<section id="top-20-músicas-com-mais-acordes-distintos" class="level4">
<h4 class="anchored" data-anchor-id="top-20-músicas-com-mais-acordes-distintos">Top 20 músicas com mais acordes distintos</h4>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'song'. You can override using the
`.groups` argument.
Selecting by cont</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="chords_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><br></p>
</section>
<section id="densidade-de-características-de-acordes" class="level4">
<h4 class="anchored" data-anchor-id="densidade-de-características-de-acordes">Densidade de características de acordes</h4>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The `&lt;scale&gt;` argument of `guides()` cannot be `FALSE`. Use "none" instead as
of ggplot2 3.3.4.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Picking joint bandwidth of 0.0168</code></pre>
</div>
<div class="cell-output-display">
<p><img src="chords_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><br></p>
</section>
<section id="quantidade-média-de-acordes-distintos-por-gênero" class="level4">
<h4 class="anchored" data-anchor-id="quantidade-média-de-acordes-distintos-por-gênero">Quantidade média de acordes distintos por gênero</h4>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'song'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="chords_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><br></p>
</section>
<section id="top-5-acordes-mais-frequentes-por-gênero" class="level4">
<h4 class="anchored" data-anchor-id="top-5-acordes-mais-frequentes-por-gênero">Top 5 acordes mais frequentes por gênero</h4>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Warning in left_join(aux, top_songs, by = "song"): Detected an unexpected many-to-many relationship between `x` and `y`.
ℹ Row 56 of `x` matches multiple rows in `y`.
ℹ Row 1359 of `y` matches multiple rows in `x`.
ℹ If a many-to-many relationship is expected, set `relationship =
  "many-to-many"` to silence this warning.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 76 × 4
# Groups:   genre [15]
   genre  chord     n prop  
   &lt;chr&gt;  &lt;chr&gt; &lt;int&gt; &lt;chr&gt; 
 1 altern G        44 5.86% 
 2 altern A        37 4.93% 
 3 altern C        36 4.79% 
 4 altern E        33 4.39% 
 5 altern D        31 4.13% 
 6 axe    D        49 4.313%
 7 axe    G        47 4.137%
 8 axe    A        42 3.697%
 9 axe    C        36 3.169%
10 axe    Em       32 2.817%
# ℹ 66 more rows</code></pre>
</div>
</div>
<p><br></p>
</section>
<section id="top-2-transições-mais-frequentes-por-gênero" class="level4">
<h4 class="anchored" data-anchor-id="top-2-transições-mais-frequentes-por-gênero">Top 2 transições mais frequentes por gênero</h4>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Warning in left_join(aux, top_songs, by = "song"): Detected an unexpected many-to-many relationship between `x` and `y`.
ℹ Row 623 of `x` matches multiple rows in `y`.
ℹ Row 1359 of `y` matches multiple rows in `x`.
ℹ If a many-to-many relationship is expected, set `relationship =
  "many-to-many"` to silence this warning.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 33 × 5
# Groups:   genre [15]
   genre      chords_ngram key       n prop 
   &lt;chr&gt;      &lt;chr&gt;        &lt;chr&gt; &lt;int&gt; &lt;chr&gt;
 1 altern     Am G         C        81 0%   
 2 altern     B F#         B        77 0%   
 3 axe        E A          A       105 2%   
 4 axe        A B          E        94 2%   
 5 blues      Am G         B        76 2%   
 6 blues      D5 C5        A        76 2%   
 7 blues      F E          B        76 2%   
 8 blues      G F          B        76 2%   
 9 bossa-nova Em7 A7       D       162 2%   
10 bossa-nova A7 D6/F#     D       133 2%   
# ℹ 23 more rows</code></pre>
</div>
</div>
<p><br></p>
</section>
<section id="top-2-progressões-mais-frequentes-por-gênero" class="level4">
<h4 class="anchored" data-anchor-id="top-2-progressões-mais-frequentes-por-gênero">Top 2 progressões mais frequentes por gênero</h4>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Warning in left_join(aux, top_songs, by = "song"): Detected an unexpected many-to-many relationship between `x` and `y`.
ℹ Row 623 of `x` matches multiple rows in `y`.
ℹ Row 1359 of `y` matches multiple rows in `x`.
ℹ If a many-to-many relationship is expected, set `relationship =
  "many-to-many"` to silence this warning.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 37 × 4
# Groups:   genre [15]
   genre  chords_ngram        n prop 
   &lt;chr&gt;  &lt;chr&gt;           &lt;int&gt; &lt;chr&gt;
 1 altern D G D G            57 0%   
 2 altern F Cm Gm F          49 0%   
 3 altern Gm F Cm Gm         49 0%   
 4 axe    A B E A            36 0%   
 5 axe    Dm7 C7M Dm7 C7M    35 0%   
 6 blues  Am G F E           76 2%   
 7 blues  A5 D5 C5 A5        74 2%   
 8 blues  E Am G F           74 2%   
 9 blues  F E Am G           74 2%   
10 blues  G F E Am           74 2%   
# ℹ 27 more rows</code></pre>
</div>
</div>
<p><br></p>
</section>
<section id="top-2-tonalidades-mais-frequentes-por-gênero" class="level4">
<h4 class="anchored" data-anchor-id="top-2-tonalidades-mais-frequentes-por-gênero">Top 2 tonalidades mais frequentes por gênero</h4>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Warning in left_join(aux, top_songs, by = "song"): Detected an unexpected many-to-many relationship between `x` and `y`.
ℹ Row 8 of `x` matches multiple rows in `y`.
ℹ Row 292 of `y` matches multiple rows in `x`.
ℹ If a many-to-many relationship is expected, set `relationship =
  "many-to-many"` to silence this warning.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 31 × 4
# Groups:   genre [15]
   genre      key       n prop 
   &lt;chr&gt;      &lt;chr&gt; &lt;int&gt; &lt;chr&gt;
 1 altern     A        14 14%  
 2 altern     C        14 14%  
 3 axe        A        23 20%  
 4 axe        D        17 14%  
 5 blues      G        22 22%  
 6 blues      A        19 20%  
 7 bossa-nova G        26 18%  
 8 bossa-nova D        23 16%  
 9 forro      G        19 18%  
10 forro      C        18 16%  
# ℹ 21 more rows</code></pre>
</div>
</div>
<p><br></p>
</section>
<section id="proporção-de-acordes-maiores-e-menores-por-gênero" class="level4">
<h4 class="anchored" data-anchor-id="proporção-de-acordes-maiores-e-menores-por-gênero">Proporção de acordes maiores e menores por gênero</h4>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 7%">
<col style="width: 4%">
<col style="width: 10%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 5%">
<col style="width: 6%">
<col style="width: 4%">
<col style="width: 5%">
<col style="width: 6%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 6%">
<col style="width: 4%">
<col style="width: 5%">
<col style="width: 9%">
</colgroup>
<tbody>
<tr class="odd">
<td style="text-align: left;">gênero</td>
<td style="text-align: left;">funk</td>
<td style="text-align: left;">bossa-nova</td>
<td style="text-align: left;">kpop</td>
<td style="text-align: left;">jazz</td>
<td style="text-align: left;">samba</td>
<td style="text-align: left;">altern</td>
<td style="text-align: left;">axe</td>
<td style="text-align: left;">forro</td>
<td style="text-align: left;">pagode</td>
<td style="text-align: left;">pop</td>
<td style="text-align: left;">mpb</td>
<td style="text-align: left;">gospel</td>
<td style="text-align: left;">rock</td>
<td style="text-align: left;">blues</td>
<td style="text-align: left;">sertanejo</td>
</tr>
<tr class="even">
<td style="text-align: left;">menores</td>
<td style="text-align: left;">0.47</td>
<td style="text-align: left;">0.37</td>
<td style="text-align: left;">0.37</td>
<td style="text-align: left;">0.36</td>
<td style="text-align: left;">0.35</td>
<td style="text-align: left;">0.34</td>
<td style="text-align: left;">0.33</td>
<td style="text-align: left;">0.33</td>
<td style="text-align: left;">0.33</td>
<td style="text-align: left;">0.33</td>
<td style="text-align: left;">0.32</td>
<td style="text-align: left;">0.28</td>
<td style="text-align: left;">0.27</td>
<td style="text-align: left;">0.24</td>
<td style="text-align: left;">0.23</td>
</tr>
<tr class="odd">
<td style="text-align: left;">maiores</td>
<td style="text-align: left;">0.53</td>
<td style="text-align: left;">0.63</td>
<td style="text-align: left;">0.63</td>
<td style="text-align: left;">0.64</td>
<td style="text-align: left;">0.65</td>
<td style="text-align: left;">0.66</td>
<td style="text-align: left;">0.67</td>
<td style="text-align: left;">0.67</td>
<td style="text-align: left;">0.67</td>
<td style="text-align: left;">0.67</td>
<td style="text-align: left;">0.68</td>
<td style="text-align: left;">0.72</td>
<td style="text-align: left;">0.73</td>
<td style="text-align: left;">0.76</td>
<td style="text-align: left;">0.77</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><br></p>
</section>
</section>
<section id="análise-exploratória-após-padronização-de-tom" class="level1">
<h1>Análise exploratória após padronização de tom</h1>
<section id="top-5-acordes-mais-frequentes-por-gênero-1" class="level4">
<h4 class="anchored" data-anchor-id="top-5-acordes-mais-frequentes-por-gênero-1">Top 5 acordes mais frequentes por gênero</h4>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Warning in left_join(aux, top_songs, by = "song"): Detected an unexpected many-to-many relationship between `x` and `y`.
ℹ Row 56 of `x` matches multiple rows in `y`.
ℹ Row 1359 of `y` matches multiple rows in `x`.
ℹ If a many-to-many relationship is expected, set `relationship =
  "many-to-many"` to silence this warning.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 75 × 4
# Groups:   genre [15]
   genre  chordC     n prop  
   &lt;chr&gt;  &lt;chr&gt;  &lt;int&gt; &lt;chr&gt; 
 1 altern Am        60 7.99% 
 2 altern C         68 9.05% 
 3 altern Dm        33 4.39% 
 4 altern F         64 8.52% 
 5 altern G         63 8.39% 
 6 axe    Am        61 5.586%
 7 axe    C         74 6.777%
 8 axe    Dm        52 4.762%
 9 axe    F         74 6.777%
10 axe    G         75 6.868%
# ℹ 65 more rows</code></pre>
</div>
</div>
<p><br></p>
</section>
<section id="top-2-transições-mais-frequentes-por-gênero-1" class="level4">
<h4 class="anchored" data-anchor-id="top-2-transições-mais-frequentes-por-gênero-1">Top 2 transições mais frequentes por gênero</h4>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Warning in left_join(aux, top_songs, by = "song"): Detected an unexpected many-to-many relationship between `x` and `y`.
ℹ Row 623 of `x` matches multiple rows in `y`.
ℹ Row 1359 of `y` matches multiple rows in `x`.
ℹ If a many-to-many relationship is expected, set `relationship =
  "many-to-many"` to silence this warning.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 31 × 4
# Groups:   genre [15]
   genre      chords_ngram     n prop 
   &lt;chr&gt;      &lt;chr&gt;        &lt;int&gt; &lt;chr&gt;
 1 altern     Am G           321 4%   
 2 altern     C G            312 4%   
 3 axe        G C            441 6%   
 4 axe        F G            401 4%   
 5 blues      F C            178 2%   
 6 blues      C F            155 2%   
 7 bossa-nova Dm7 G7         212 2%   
 8 bossa-nova G7 C6/E        133 2%   
 9 forro      C G            631 6%   
10 forro      F C            513 6%   
# ℹ 21 more rows</code></pre>
</div>
</div>
<p><br></p>
</section>
<section id="top-2-progressões-mais-frequentes-por-gênero-1" class="level4">
<h4 class="anchored" data-anchor-id="top-2-progressões-mais-frequentes-por-gênero-1">Top 2 progressões mais frequentes por gênero</h4>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Warning in left_join(aux, top_songs, by = "song"): Detected an unexpected many-to-many relationship between `x` and `y`.
ℹ Row 602 of `x` matches multiple rows in `y`.
ℹ Row 1359 of `y` matches multiple rows in `x`.
ℹ If a many-to-many relationship is expected, set `relationship =
  "many-to-many"` to silence this warning.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 35 × 4
# Groups:   genre [15]
   genre      chords_ngram        n prop 
   &lt;chr&gt;      &lt;chr&gt;           &lt;int&gt; &lt;chr&gt;
 1 altern     F C G Am           82 0%   
 2 altern     Am F C G           81 0%   
 3 axe        F G C F            65 0%   
 4 axe        G C F G            62 0%   
 5 blues      A#m G# F# F        76 2%   
 6 blues      C5 F5 D#5 C5       74 2%   
 7 blues      F A#m G# F#        74 2%   
 8 blues      F# F A#m G#        74 2%   
 9 blues      G# F# F A#m        74 2%   
10 bossa-nova Am Am/C B7 A#7M    88 0%   
# ℹ 25 more rows</code></pre>
</div>
</div>
<p><br></p>
</section>
</section>
<section id="tf-idf" class="level1">
<h1>TF-IDF</h1>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Warning in left_join(aux, top_songs, by = "song"): Detected an unexpected many-to-many relationship between `x` and `y`.
ℹ Row 602 of `x` matches multiple rows in `y`.
ℹ Row 1359 of `y` matches multiple rows in `x`.
ℹ If a many-to-many relationship is expected, set `relationship =
  "many-to-many"` to silence this warning.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Adding missing grouping variables: `genre`
Joining with `by = join_by(genre)`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 40,698 × 7
# Groups:   genre [15]
   genre      chords_ngram        n total      tf   idf tf_idf
   &lt;chr&gt;      &lt;chr&gt;           &lt;int&gt; &lt;int&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
 1 blues      A#m-G#-F#-F        76  6866 0.0111   2.71 0.0300
 2 blues      C5-F5-D#5-C5       74  6866 0.0108   2.71 0.0292
 3 blues      F#-F-A#m-G#        74  6866 0.0108   2.71 0.0292
 4 blues      F-A#m-G#-F#        74  6866 0.0108   2.71 0.0292
 5 blues      G#-F#-F-A#m        74  6866 0.0108   2.71 0.0292
 6 blues      C5-C5-F5-D#5       73  6866 0.0106   2.71 0.0288
 7 blues      D#5-C5-C5-F5       73  6866 0.0106   2.71 0.0288
 8 blues      F5-D#5-C5-C5       73  6866 0.0106   2.71 0.0288
 9 bossa-nova Am-Am/C-B7-A#7M    88 10951 0.00804  2.71 0.0218
10 bossa-nova A#7M-Am-Am/C-B7    76 10951 0.00694  2.71 0.0188
# ℹ 40,688 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>tfidf_genre <span class="sc">%&gt;%</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(genre) <span class="sc">%&gt;%</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(tf_idf, <span class="at">n =</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(tf_idf, <span class="fu">fct_reorder</span>(chords_ngram, tf_idf))) <span class="sc">+</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">show.legend =</span> <span class="cn">FALSE</span>, <span class="at">fill =</span> <span class="st">'dodgerblue4'</span>, <span class="at">colour =</span> <span class="st">'white'</span>) <span class="sc">+</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>genre, <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="chords_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><br></p>
</section>
<section id="knn" class="level1">
<h1>KNN</h1>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Warning in left_join(aux, top_songs, by = "song"): Detected an unexpected many-to-many relationship between `x` and `y`.
ℹ Row 602 of `x` matches multiple rows in `y`.
ℹ Row 1359 of `y` matches multiple rows in `x`.
ℹ If a many-to-many relationship is expected, set `relationship =
  "many-to-many"` to silence this warning.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Adding missing grouping variables: `music`
Joining with `by = join_by(music)`
Joining with `by = join_by(music)`</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tic</span>()</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>music_pivot <span class="ot">&lt;-</span> tfidf_music <span class="sc">%&gt;%</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> chords_ngram, <span class="at">values_from =</span> tf_idf) <span class="sc">%&gt;%</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_all</span>(<span class="sc">~</span><span class="fu">replace_na</span>(., <span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`mutate_all()` ignored the following grouping variables:
• Column `music`
ℹ Use `mutate_at(df, vars(-group_cols()), myoperation)` to silence the message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">toc</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.719 sec elapsed</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">prop.table</span>(<span class="fu">table</span>(music_pivot<span class="sc">$</span>genre)),<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
   gospel       mpb      rock sertanejo 
     0.27      0.17      0.22      0.34 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># save(music_pivot, file = "music_pivot.RData")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1209</span>)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>music_pivot <span class="ot">&lt;-</span> music_pivot <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>()</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>music_pivot<span class="sc">$</span>genre <span class="ot">&lt;-</span> <span class="fu">as_factor</span>(music_pivot<span class="sc">$</span>genre)</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>split <span class="ot">=</span> <span class="fu">sample.split</span>(music_pivot<span class="sc">$</span>genre, <span class="at">SplitRatio =</span> <span class="fl">0.75</span>)</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>training <span class="ot">=</span> <span class="fu">subset</span>(music_pivot, split <span class="sc">==</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>(music))</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>test <span class="ot">=</span> <span class="fu">subset</span>(music_pivot, split <span class="sc">==</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>(music))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tic</span>()</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1209</span>)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>trctrl <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"repeatedcv"</span>, <span class="at">repeats =</span> <span class="dv">3</span>)</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>knn_fit <span class="ot">&lt;-</span> <span class="fu">train</span>(genre <span class="sc">~</span>., <span class="at">data =</span> training, <span class="at">method =</span> <span class="st">"knn"</span>,</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a> <span class="at">trControl=</span>trctrl,</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a> <span class="co"># preProcess = c("center", "scale"),</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a> <span class="at">tuneGrid =</span> <span class="fu">data.frame</span>(<span class="at">k=</span><span class="fu">seq</span>(<span class="dv">5</span>,<span class="dv">15</span>,<span class="dv">1</span>)))</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a><span class="co"># knn_fit &lt;- train(genre ~., data = training, method = "multinom",</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a><span class="co">#  trControl=trctrl)</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a><span class="co"># toc()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>testar seq maior para k</li>
<li>tentar não fazer preprocess</li>
<li>testar logistic regression in caret (multinom)</li>
<li>testar componentes principais</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>knn_fit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>k-Nearest Neighbors 

171 samples
176 predictors
  4 classes: 'gospel', 'sertanejo', 'mpb', 'rock' 

No pre-processing
Resampling: Cross-Validated (10 fold, repeated 3 times) 
Summary of sample sizes: 155, 156, 154, 154, 153, 154, ... 
Resampling results across tuning parameters:

  k   Accuracy   Kappa     
   5  0.4051443  0.13998839
   6  0.3891068  0.11047173
   7  0.3626552  0.06297447
   8  0.3566340  0.04996525
   9  0.3571269  0.04780248
  10  0.3607244  0.04525073
  11  0.3587337  0.04096533
  12  0.3526988  0.02991616
  13  0.3581454  0.03766894
  14  0.3577751  0.03563980
  15  0.3540577  0.02818290

Accuracy was used to select the optimal model using the largest value.
The final value used for the model was k = 5.</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(knn_fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="chords_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(knn_fit, <span class="at">newdata =</span> test, <span class="at">type =</span> <span class="st">"raw"</span>)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>test <span class="sc">%&gt;%</span> <span class="fu">select</span>(genre, pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 57 × 2
   genre     pred     
   &lt;fct&gt;     &lt;fct&gt;    
 1 sertanejo sertanejo
 2 gospel    gospel   
 3 sertanejo sertanejo
 4 mpb       sertanejo
 5 gospel    gospel   
 6 rock      sertanejo
 7 gospel    sertanejo
 8 gospel    sertanejo
 9 mpb       sertanejo
10 rock      gospel   
# ℹ 47 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(test<span class="sc">$</span>pred, test<span class="sc">$</span>genre)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

           Reference
Prediction  gospel sertanejo mpb rock
  gospel         4         4   1    1
  sertanejo     11        14   6    6
  mpb            0         0   0    0
  rock           1         1   3    5

Overall Statistics
                                          
               Accuracy : 0.4035          
                 95% CI : (0.2756, 0.5418)
    No Information Rate : 0.3333          
    P-Value [Acc &gt; NIR] : 0.162499        
                                          
                  Kappa : 0.1447          
                                          
 Mcnemar's Test P-Value : 0.009897        

Statistics by Class:

                     Class: gospel Class: sertanejo Class: mpb Class: rock
Sensitivity                0.25000           0.7368     0.0000     0.41667
Specificity                0.85366           0.3947     1.0000     0.88889
Pos Pred Value             0.40000           0.3784        NaN     0.50000
Neg Pred Value             0.74468           0.7500     0.8246     0.85106
Prevalence                 0.28070           0.3333     0.1754     0.21053
Detection Rate             0.07018           0.2456     0.0000     0.08772
Detection Prevalence       0.17544           0.6491     0.0000     0.17544
Balanced Accuracy          0.55183           0.5658     0.5000     0.65278</code></pre>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>